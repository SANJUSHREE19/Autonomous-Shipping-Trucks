<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Truck Fleet Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script>
        function applyTheme() {
            const theme = localStorage.getItem("theme") || "light";
            document.documentElement.setAttribute("data-theme", theme);
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute("data-theme");
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            localStorage.setItem("theme", newTheme);
            document.documentElement.setAttribute("data-theme", newTheme);
        }
    </script>
</head>
<body onload="applyTheme()">
    <!-- Top Navigation Bar -->
    <div class="navbar">
        <div class="logo">
            <a href="{{ url_for('index') }}">
                <span style="font-weight: 700;">Auto</span><span style="font-weight: 400;">Trucks</span>
            </a>
        </div>
        <div class="nav-links">
            {% if session.get('username') %}
                <a href="{{ url_for('index') }}">Dashboard</a>
                <a href="{{ url_for('track_map') }}">Track Map</a>
                <a href="{{ url_for('schedule') }}">Schedule</a>
                <a href="{{ url_for('request_service') }}">Service</a>
                <a href="{{ url_for('simulation') }}">Simulation</a>
                <a href="{{ url_for('alerts_dashboard') }}" class="notification-badge">
                    Alerts
                    {% if unread_alert_count > 0 %}
                    <span class="badge">{{ unread_alert_count }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}">Login</a>
                <a href="{{ url_for('register') }}">Register</a>
            {% endif %}
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        {% if session.get('username') %}
            <a href="{{ url_for('index') }}" {% if request.path == url_for('index') %}class="active"{% endif %}>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('add_truck') }}" {% if request.path == url_for('add_truck') %}class="active"{% endif %}>
                <span>Add Truck</span>
            </a>
            <a href="{{ url_for('track_trucks') }}" {% if request.path == url_for('track_trucks') %}class="active"{% endif %}>
                <span>List View</span>
            </a>
            <a href="{{ url_for('track_map') }}" {% if request.path == url_for('track_map') %}class="active"{% endif %}>
                <span>Map View</span>
            </a>
            <a href="{{ url_for('schedule') }}" {% if request.path == url_for('schedule') %}class="active"{% endif %}>
                <span>Schedule Trucks</span>
            </a>
            <a href="{{ url_for('request_service') }}" {% if request.path == url_for('request_service') %}class="active"{% endif %}>
                <span>Request Service</span>
            </a>
            <a href="{{ url_for('reports') }}" {% if request.path == url_for('reports') %}class="active"{% endif %}>
                <span>Reports</span>
            </a>
            <a href="{{ url_for('alerts_dashboard') }}" {% if request.path == url_for('alerts_dashboard') %}class="active"{% endif %} class="notification-badge">
                <span>Alerts</span>
                {% if unread_alert_count > 0 %}
                <span class="badge sidebar-badge">{{ unread_alert_count }}</span>
                {% endif %}
            </a>
            <a href="{{ url_for('simulation') }}" {% if request.path == url_for('simulation') %}class="active"{% endif %}>
                <span>Run Simulation</span>
            </a>
            <a href="{{ url_for('profile') }}" {% if request.path == url_for('profile') %}class="active"{% endif %}>
                <span>My Profile</span>
            </a>
        {% endif %}
    </div>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </div>

    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </div>

    <script>
        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const flashMessages = document.querySelector('.flash-messages');
                if (flashMessages) {
                    flashMessages.style.opacity = '0';
                    setTimeout(function() {
                        flashMessages.style.display = 'none';
                    }, 500);
                }
            }, 5000);
        });
    </script>
</body>
</html>